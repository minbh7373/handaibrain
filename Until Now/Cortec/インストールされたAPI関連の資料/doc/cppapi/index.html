<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>CorTec bicapi - documentation: BIC C++ API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CorTec bicapi - documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">BIC C++ API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the API documentation of the BIC C++ API.</p>
<h1><a class="anchor" id="walkthrough_sec"></a>
Walkthrough</h1>
<p>The BIC C++ API enables programmatic access to BIC implants. In the following sections, examples about how this API can be used are provided.</p>
<h2><a class="anchor" id="discovery_example_sec"></a>
Example 1: initial access and device discovery</h2>
<p>The functions in <a class="el" href="bicapi_8h.html">bicapi.h</a> provide the central access point to the API. The following code example shows how to create an implant factory and print some information about the connected external units and implants (i.e., device discovery).</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bicapi_8h.html">bicapi.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="comment">// Get implant factory</span></div><div class="line">std::unique_ptr&lt;IImplantFactory&gt; implantFactory(<a class="code" href="bicapi_8h.html#a98dec71ba928845ba6932695d6357160">createImplantFactory</a>());</div></div><!-- fragment --><p>This factory can be used to obtain information about all implants connected to the computer:</p>
<div class="fragment"><div class="line">std::vector&lt;CExternalUnitInfo*&gt; exInfos = implantFactory-&gt;getExternalUnitInfos();</div><div class="line"><span class="keywordflow">for</span>(CExternalUnitInfo* exInfo : exInfos) <span class="comment">// for each external unit...</span></div><div class="line">{ </div><div class="line">    <span class="comment">// print information to stdout</span></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Found external unit with ID=&quot;</span> &lt;&lt; exInfo-&gt;getDeviceId() </div><div class="line">                                                &lt;&lt; <span class="stringliteral">&quot;, type=&quot;</span> &lt;&lt;  exInfo-&gt;getImplantType() </div><div class="line">                                                &lt;&lt; std::endl;</div><div class="line">    <span class="comment">// then try to get infos about connected implant (if any)</span></div><div class="line">    std::unique_ptr&lt;CImplantInfo&gt; impInfo(implantFactory-&gt;getImplantInfo(*exInfo));</div><div class="line">    <span class="keywordflow">if</span>(impInfo == <span class="keyword">nullptr</span>)</div><div class="line">    {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;No implant connected to &quot;</span> &lt;&lt; exInfo-&gt;getDeviceId() &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;--&gt; connected implant: ID=&quot;</span> &lt;&lt; impInfo-&gt;getDeviceId() </div><div class="line">                                                &lt;&lt; <span class="stringliteral">&quot;, type=&quot;</span> &lt;&lt;  impInfo-&gt;getImplantType() </div><div class="line">                                                &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">} </div><div class="line"></div><div class="line"><span class="comment">// final cleanup</span></div><div class="line"><span class="keywordflow">for</span>(CExternalUnitInfo* exInfo : exInfos)</div><div class="line">{</div><div class="line">    <span class="keyword">delete</span> exInfo;</div><div class="line">}</div></div><!-- fragment --><p> More information about the classes used in the example above can be found at the respective class documentations:</p><ul>
<li><a class="el" href="classcortec_1_1implantapi_1_1_i_implant_factory.html" title="Device discovery and factory interface creating instances of IImplant. ">cortec::implantapi::IImplantFactory</a></li>
<li><a class="el" href="classcortec_1_1implantapi_1_1_c_external_unit_info.html" title="Information on the external unit. ">cortec::implantapi::CExternalUnitInfo</a></li>
<li><a class="el" href="classcortec_1_1implantapi_1_1_c_implant_info.html" title="Information on the implant including channel info. ">cortec::implantapi::CImplantInfo</a></li>
</ul>
<h2><a class="anchor" id="creation_example_sec"></a>
Example 2: implant object creation</h2>
<p>This example creates an IImplant object using an IImplantFactory. It assumes that there is one external unit connected and one implant is connected to this external unit. The IImplant object is then used to query the temperature and the humidity within the implant's hermetic capsule.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bicapi_8h.html">bicapi.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">std::unique_ptr&lt;IImplantFactory&gt; implantFactory(<a class="code" href="bicapi_8h.html#a98dec71ba928845ba6932695d6357160">createImplantFactory</a>());</div><div class="line">std::vector&lt;CExternalUnitInfo*&gt; exInfos = implantFactory-&gt;getExternalUnitInfos();</div><div class="line">std::unique_ptr&lt;CImplantInfo&gt; impInfo(implantFactory-&gt;getImplantInfo(*exInfos[0]);</div><div class="line"></div><div class="line"><span class="comment">// create implant object via factory</span></div><div class="line">std::unique_ptr&lt;IImplant&gt; implant(implantFactory-&gt;create(*exInfos[0], *impInfo));</div><div class="line"></div><div class="line"><span class="comment">// now print some diagnostic data from the implant.</span></div><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;implant temperature=&quot;</span> &lt;&lt; implant-&gt;getTemperature() &lt;&lt; <span class="stringliteral">&quot;degree celsius&quot;</span> &lt;&lt; std::endl;</div><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;implant humidity=&quot;</span> &lt;&lt; implant-&gt;getHumidity() &lt;&lt; <span class="stringliteral">&quot;%rh&quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line"> <span class="comment">// final cleanup</span></div><div class="line"><span class="keywordflow">for</span>(CExternalUnitInfo* exInfo : exInfos)</div><div class="line">{</div><div class="line">    <span class="keyword">delete</span> exInfo;</div><div class="line">}</div></div><!-- fragment --><p>More information about the classes used in the example above can be found at the respective class documentations:</p><ul>
<li><a class="el" href="classcortec_1_1implantapi_1_1_i_implant_factory.html" title="Device discovery and factory interface creating instances of IImplant. ">cortec::implantapi::IImplantFactory</a></li>
<li><a class="el" href="classcortec_1_1implantapi_1_1_i_implant.html" title="Interface for an implant. ">cortec::implantapi::IImplant</a></li>
<li><a class="el" href="classcortec_1_1implantapi_1_1_c_external_unit_info.html" title="Information on the external unit. ">cortec::implantapi::CExternalUnitInfo</a></li>
<li><a class="el" href="classcortec_1_1implantapi_1_1_c_implant_info.html" title="Information on the implant including channel info. ">cortec::implantapi::CImplantInfo</a></li>
</ul>
<h2><a class="anchor" id="measurement_example_sec"></a>
Example 3: obtaining measurement data</h2>
<p>In this example, an IImplantListener object is created and registered to an IImplant object. Then, measurement is started and one channel is written to stdout.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_i_implant_8h.html">IImplant.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_i_implant_listener_8h.html">IImplantListener.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_sample_8h.html">Sample.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;thread&gt;</span></div><div class="line"><span class="comment">// ...</span></div><div class="line"></div><div class="line"><span class="comment">// First implement IImplantListener interface</span></div><div class="line"><span class="keyword">class </span>CPrintListener : <span class="keyword">public</span> IImplantListener</div><div class="line">{</div><div class="line">  <span class="keyword">public</span>:    </div><div class="line">  </div><div class="line">  <span class="comment">// ... it is assumed that all other callbacks of IImplantListener are implemented with empty methods.</span></div><div class="line">  </div><div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> onData(<span class="keyword">const</span> std::vector&lt;CSample*&gt;* samples)</div><div class="line">  {</div><div class="line">      <span class="keywordflow">for</span>(CSample* s : samples)</div><div class="line">      {</div><div class="line">          <span class="comment">// print measurement channel 1 to stdout</span></div><div class="line">          std::unique_ptr&lt;double[]&gt; ms(s-&gt;getMeasurements());</div><div class="line">          std::cout &lt;&lt; ms[0] &lt;&lt; std::endl;</div><div class="line">          <span class="comment">// delete sample, as pointer ownership of it was passed to this listener</span></div><div class="line">          <span class="keyword">delete</span> s;</div><div class="line">      }</div><div class="line">      <span class="comment">// delete samples, as pointer ownership of it was passed to this listener</span></div><div class="line">      <span class="keyword">delete</span> samples;</div><div class="line">   }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// ...</span></div><div class="line"></div><div class="line"><span class="comment">// now register listener to a previously created IImplant object.</span></div><div class="line">CPrintListener listener;</div><div class="line">implant-&gt;registerListener(&amp;listener);</div><div class="line"></div><div class="line"><span class="comment">// ref channels must not include channel 1 (index 0) in this example, because we want to measure channel 1.</span></div><div class="line"><span class="keyword">const</span> std::set&lt;uint32_t&gt;&amp; refChannels = {1, 2, 3, 4}; </div><div class="line">implant-&gt;startMeasurement(refChannels);</div><div class="line"></div><div class="line"><span class="comment">// Wait for 2 seconds. During this time, measurement values from channel 1 are written to stdout.</span></div><div class="line">std::this_thread::sleep_for(2s);</div><div class="line"></div><div class="line"><span class="comment">// Do cleanup...</span></div><div class="line">implant-&gt;stopMeasurement();</div><div class="line">implant-&gt;registerListener(<span class="keyword">nullptr</span>); <span class="comment">// unregister listener prior to its destruction</span></div></div><!-- fragment --><dl class="section attention"><dt>Attention</dt><dd>Please note that this example is only to illustrate how to obtain measurement values. It writes a value to stdout approximately every millisecond (i.e., with the sampling frequency) will cause performance issues on slow machines. For productive use, the measurement data can be passed to another thread for further processing or written to a binary file, instead of being written to stdout.</dd></dl>
<p>More information about the classes used in the example above can be found at the respective class documentations:</p><ul>
<li><a class="el" href="classcortec_1_1implantapi_1_1_i_implant.html" title="Interface for an implant. ">cortec::implantapi::IImplant</a></li>
<li><a class="el" href="classcortec_1_1implantapi_1_1_i_implant_listener.html" title="Interface for receiving measurement data, implant state changes or implant health state changes from ...">cortec::implantapi::IImplantListener</a></li>
<li><a class="el" href="classcortec_1_1implantapi_1_1_c_sample.html" title="Class for measurement data read by the implant at one point in time, i.e. for one sample...">cortec::implantapi::CSample</a></li>
</ul>
<h2><a class="anchor" id="stimulation_example_sec"></a>
Example 4: doing stimulation</h2>
<p>This example shows how to do electrical stimulation via an implant by first creating a stimulation command that stimulates with a frequency of ~18.5Hz.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bicapi_8h.html">bicapi.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_i_stimulation_command_8h.html">IStimulationCommand.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_i_stimulation_function_8h.html">IStimulationFunction.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bic3232constants_8h.html">bic3232constants.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_i_implant_8h.html">IImplant.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// ...</span></div><div class="line"></div><div class="line"><span class="comment">// helper function</span></div><div class="line">IStimulationFunction* createStimulationFunction(<span class="keyword">const</span> <span class="keywordtype">double</span> amplitude, <span class="keyword">const</span> uint64_t pulseWidth, <span class="keyword">const</span> uint64_t functionPeriod)</div><div class="line">{</div><div class="line">  <span class="keyword">const</span> uint64_t dz0 = 10; <span class="comment">// in microseconds 10micros is minimum</span></div><div class="line">  int64_t dz1 = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(functionPeriod) - 5 * static_cast&lt;int64_t&gt;(pulseWidth) - 2 * <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(dz0);</div><div class="line">  <span class="keywordflow">if</span> (dz1 &lt; 10)</div><div class="line">  {</div><div class="line">      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Function duration and pulseWidth do not match.&quot;</span>); </div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (pulseWidth &gt; 2550 || dz1 &gt; 20400)</div><div class="line">  {</div><div class="line">      <span class="keywordflow">throw</span> cortec::base::CInvalidArgumentException(<span class="stringliteral">&quot;Parameters out of range.&quot;</span>); </div><div class="line">  }</div><div class="line">  <span class="keyword">static</span> unique_ptr&lt;IStimulationCommandFactory&gt; factory(<a class="code" href="bicapi_8h.html#a9d55a8bde41a2125188fb403bda4455b">createStimulationCommandFactory</a>());</div><div class="line">  <span class="comment">// Defining StimulationFunction with fixed duration of 12500micros </span></div><div class="line">  IStimulationFunction* pulseStimFunction = factory-&gt;createStimulationFunction(); </div><div class="line">  IStimulationAtom* pwAtom = factory-&gt;createRect4AmplitudeStimulationAtom(amplitude, amplitude, amplitude, amplitude, </div><div class="line">       pulseWidth); <span class="comment">// main pulse</span></div><div class="line">  pulseStimFunction-&gt;append(pwAtom);                                          </div><div class="line">  pulseStimFunction-&gt;append(factory-&gt;createRect4AmplitudeStimulationAtom(0.0, 0.0, 0.0, 0.0, dz0));     <span class="comment">// dz0 pause</span></div><div class="line">  pulseStimFunction-&gt;append(factory-&gt;createRect4AmplitudeStimulationAtom(                <span class="comment">// compensation pulse</span></div><div class="line">                             amplitude / static_cast&lt;double&gt;(-4.0) </div><div class="line">                           ; amplitude / static_cast&lt;double&gt;(-4.0)</div><div class="line">                           ; amplitude / static_cast&lt;double&gt;(-4.0)</div><div class="line">                           ; amplitude / static_cast&lt;double&gt;(-4.0)</div><div class="line">                           , static_cast&lt;uint64_t&gt;(4.0) * pwAtom-&gt;getDuration()));         </div><div class="line">  pulseStimFunction-&gt;append(factory-&gt;createRect4AmplitudeStimulationAtom(0.0, 0.0, 0.0, 0.0, dz0));     <span class="comment">// dz0 pause</span></div><div class="line">  pulseStimFunction-&gt;append(factory-&gt;createRect4AmplitudeStimulationAtom(0.0, 0.0, 0.0, 0.0, dz1));     <span class="comment">// dz1 pause</span></div><div class="line">  <span class="keywordflow">return</span> pulseStimFunction;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// ...</span></div><div class="line"></div><div class="line">std::unique_ptr&lt;IStimulationCommandFactory&gt; factory = <a class="code" href="bicapi_8h.html#a9d55a8bde41a2125188fb403bda4455b">createStimulationCommandFactory</a>();</div><div class="line">IStimulationCommand* stimCmd = factory.createStimulationCommand();         </div><div class="line"></div><div class="line">std::unique_ptr&lt;IStimulationFunction&gt; stimFunction(createStimulationFunction( 100 <span class="comment">// microampere</span></div><div class="line">                                                                            , 1100 <span class="comment">// micros</span></div><div class="line">                                                                            , 12500 <span class="comment">// micros</span></div><div class="line">                                                                            ));</div><div class="line">stimFunction-&gt;setRepetitions(1);</div><div class="line"></div><div class="line"><span class="comment">// set stimulation channels: channel 1 as source, ground electrode as destination.</span></div><div class="line">std::set&lt;uint32_t&gt; sourceChannels;</div><div class="line">sourceChannels.insert(0);</div><div class="line">std::set&lt;uint32_t&gt; destinationChannels;</div><div class="line">destinationChannels.insert(<a class="code" href="struct_b_i_c3232_constants.html#a2b911a84ce72a182de82aec02a4b8c3f">BIC3232Constants::c_groundElectrode</a>);</div><div class="line">stimFunction-&gt;setVirtualStimulationElectrodes(sourceChannels, destinationChannels);</div><div class="line"></div><div class="line">std::unique_ptr&lt;IStimulationFunction&gt; pauseFunction(createStimulationFunction(0.0, 2500, 20780));</div><div class="line">pauseFunction-&gt;setRepetitions(2);</div><div class="line"></div><div class="line"><span class="comment">// beta 17-20Hz: 18,5185185Hz ==&gt; one pulse per 54,0 (~1110 repetitions for 60s)</span></div><div class="line"><span class="keywordflow">for</span> (brn::size_t i = 0; i &lt; 1110; ++i)</div><div class="line">{</div><div class="line">  <span class="comment">//  12500micros + 20780micros * 2 = 54060 micros</span></div><div class="line">  stimCmd-&gt;append(stimFunction-&gt;clone());</div><div class="line">  stimCmd-&gt;append(pauseFunction-&gt;clone()); </div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// start the stimulation...</span></div><div class="line">implant-&gt;startStimulation(stimCmd);</div><div class="line"><span class="comment">// wait for 2 seconds. During this time, the implant executes the stimulation command.</span></div><div class="line">std::this_thread::sleep_for(2s);</div></div><!-- fragment --><p>For more detailed information about how to build stimulation commands and what constraints apply to them, see file docs\stimulation_tutorial.pdf in the BIC C++ API installation directory.</p>
<p>More information about the classes used in the example above can be found at the respective class documentations:</p><ul>
<li><a class="el" href="classcortec_1_1implantapi_1_1_i_implant.html" title="Interface for an implant. ">cortec::implantapi::IImplant</a></li>
<li><a class="el" href="classcortec_1_1implantapi_1_1_i_stimulation_command_factory.html" title="Factory interface for creation of stimulation commands. ">cortec::implantapi::IStimulationCommandFactory</a></li>
<li><a class="el" href="classcortec_1_1implantapi_1_1_i_stimulation_command.html" title="Interface for classes that can be sent to an implant to elicit electrical stimulation. ">cortec::implantapi::IStimulationCommand</a></li>
<li><a class="el" href="classcortec_1_1implantapi_1_1_i_stimulation_function.html" title="A IStimulationFunction defines what stimulation signal is applied to which electrodes. ">cortec::implantapi::IStimulationFunction</a></li>
</ul>
<h1><a class="anchor" id="conv_sec"></a>
Programming Conventions</h1>
<p>This API uses the following conventions:</p><ul>
<li>All classes and functions are <em>not</em> thread-safe unless stated otherwise in the API documentation.</li>
<li>Pointer ownership is <em>not</em> passed unless stated otherwise in the API documentation. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
